<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Basic EKS Cluster with Cluster Autoscaler - Random Stuff From My Head</title>
  <meta name="description" content="EKSCTL can be used to quickly deploy a AWS EKS Cluster.
This is based on using a sandbox AWS account The supporting files can be found on Github
Create an EKS deployment file, I tend to create individual nodegroups dedicated to a single AZ
[cloudshell-user@ip-10-1-181-252 cluster-autoscaler]$ cat ca-cluster.yaml --- apiVersion: eksctl.io/v1alpha5 kind: ClusterConfig metadata: name: ca-cluster --- apiVersion: eksctl.io/v1alpha5 kind: ClusterConfig metadata: name: ca-cluster region: us-east-1 version: &#34;1.22&#34; availabilityZones: [&#34;us-east-1a&#34;, &#34;us-east-1b&#34;, &#34;us-east-1c&#34;] managedNodeGroups: - name: nodegroupA desiredCapacity: 1 availabilityZones: [&#34;us-east-1a&#34;] instanceType: t3.">
  <meta name="author" content="Neil Armitage"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Random Stuff From My Head",
    
    "url": "https:\/\/neilarmitage.com\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/neilarmitage.com\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/neilarmitage.com\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/neilarmitage.com\/posts\/basic-eks-cluster\/",
          "name": "Basic eks cluster with cluster autoscaler"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Neil Armitage"
  },
  "headline": "Basic EKS Cluster with Cluster Autoscaler",
  "description" : "EKSCTL can be used to quickly deploy a AWS EKS Cluster.\nThis is based on using a sandbox AWS account The supporting files can be found on Github\nCreate an EKS deployment file, I tend to create individual nodegroups dedicated to a single AZ\n[cloudshell-user@ip-10-1-181-252 cluster-autoscaler]$ cat ca-cluster.yaml --- apiVersion: eksctl.io\/v1alpha5 kind: ClusterConfig metadata: name: ca-cluster --- apiVersion: eksctl.io\/v1alpha5 kind: ClusterConfig metadata: name: ca-cluster region: us-east-1 version: \u0026#34;1.22\u0026#34; availabilityZones: [\u0026#34;us-east-1a\u0026#34;, \u0026#34;us-east-1b\u0026#34;, \u0026#34;us-east-1c\u0026#34;] managedNodeGroups: - name: nodegroupA desiredCapacity: 1 availabilityZones: [\u0026#34;us-east-1a\u0026#34;] instanceType: t3.",
  "inLanguage" : "en",
  "wordCount":  1528 ,
  "datePublished" : "2022-05-11T10:38:08",
  "dateModified" : "2022-05-11T10:38:08",
  "image" : "https:\/\/neilarmitage.com\/",
  "keywords" : [ "AWS, EKS" ],
  "mainEntityOfPage" : "https:\/\/neilarmitage.com\/posts\/basic-eks-cluster\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/neilarmitage.com\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/neilarmitage.com\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Basic EKS Cluster with Cluster Autoscaler" />
<meta property="og:description" content="EKSCTL can be used to quickly deploy a AWS EKS Cluster.
This is based on using a sandbox AWS account The supporting files can be found on Github
Create an EKS deployment file, I tend to create individual nodegroups dedicated to a single AZ
[cloudshell-user@ip-10-1-181-252 cluster-autoscaler]$ cat ca-cluster.yaml --- apiVersion: eksctl.io/v1alpha5 kind: ClusterConfig metadata: name: ca-cluster --- apiVersion: eksctl.io/v1alpha5 kind: ClusterConfig metadata: name: ca-cluster region: us-east-1 version: &#34;1.22&#34; availabilityZones: [&#34;us-east-1a&#34;, &#34;us-east-1b&#34;, &#34;us-east-1c&#34;] managedNodeGroups: - name: nodegroupA desiredCapacity: 1 availabilityZones: [&#34;us-east-1a&#34;] instanceType: t3.">
<meta property="og:url" content="https://neilarmitage.com/posts/basic-eks-cluster/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Random Stuff From My Head" />

  <meta name="twitter:title" content="Basic EKS Cluster with Cluster Autoscaler" />
  <meta name="twitter:description" content="EKSCTL can be used to quickly deploy a AWS EKS Cluster.
This is based on using a sandbox AWS account The supporting files can be found on Github
Create an EKS deployment file, I tend to create â€¦">
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@narmitage" />
  <meta name="twitter:creator" content="@narmitage" />
  <meta name="generator" content="Hugo 0.107.0">
  <link rel="alternate" href="https://neilarmitage.com/index.xml" type="application/rss+xml" title="Random Stuff From My Head"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://neilarmitage.com/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://neilarmitage.com/css/syntax.css" /><link rel="stylesheet" href="https://neilarmitage.com/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">

  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://neilarmitage.com/">Random Stuff From My Head</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="about" href="/about/">about</a>
            </li>
          
        
          
            <li>
              <a title="talks" href="https://speakerdeck.com/neilarmitage">talks</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="posts-heading">
              
                <h1>Basic EKS Cluster with Cluster Autoscaler</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>EKSCTL can be used to quickly deploy a AWS EKS Cluster.</p>
<p>This is based on using a sandbox AWS account <!-- raw HTML omitted --></p>
<p>The supporting files can be found on <a href="https://github.com/narmitag/eks/tree/main/cluster-autoscaler">Github</a></p>
<p>Create an EKS deployment file, I tend to create individual nodegroups dedicated to a single AZ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ cat ca-cluster.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">apiVersion: eksctl.io/v1alpha5
</span></span><span class="line"><span class="cl">kind: ClusterConfig
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: ca-cluster
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">apiVersion: eksctl.io/v1alpha5
</span></span><span class="line"><span class="cl">kind: ClusterConfig
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: ca-cluster
</span></span><span class="line"><span class="cl">  region: us-east-1
</span></span><span class="line"><span class="cl">  version: <span class="s2">&#34;1.22&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">availabilityZones: <span class="o">[</span><span class="s2">&#34;us-east-1a&#34;</span>, <span class="s2">&#34;us-east-1b&#34;</span>, <span class="s2">&#34;us-east-1c&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">managedNodeGroups:
</span></span><span class="line"><span class="cl">- name: nodegroupA
</span></span><span class="line"><span class="cl">  desiredCapacity: <span class="m">1</span>
</span></span><span class="line"><span class="cl">  availabilityZones: <span class="o">[</span><span class="s2">&#34;us-east-1a&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  instanceType: t3.small
</span></span><span class="line"><span class="cl">  spot: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">- name: nodegroupB
</span></span><span class="line"><span class="cl">  desiredCapacity: <span class="m">1</span>
</span></span><span class="line"><span class="cl">  availabilityZones: <span class="o">[</span><span class="s2">&#34;us-east-1b&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  instanceType: t3.small
</span></span><span class="line"><span class="cl">  spot: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">- name: nodegroupC
</span></span><span class="line"><span class="cl">  desiredCapacity: <span class="m">1</span>
</span></span><span class="line"><span class="cl">  availabilityZones: <span class="o">[</span><span class="s2">&#34;us-east-1c&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  instanceType: t3.small
</span></span><span class="line"><span class="cl">  spot: <span class="nb">true</span>
</span></span></code></pre></div><p>Create the cluster (will take a long time)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ eksctl create cluster -f ca-cluster.yaml
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  eksctl version 0.96.0
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  using region us-east-1
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  subnets <span class="k">for</span> us-east-1a - public:192.168.0.0/19 private:192.168.96.0/19
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  subnets <span class="k">for</span> us-east-1b - public:192.168.32.0/19 private:192.168.128.0/19
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  subnets <span class="k">for</span> us-east-1c - public:192.168.64.0/19 private:192.168.160.0/19
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  nodegroup <span class="s2">&#34;nodegroupA&#34;</span> will use <span class="s2">&#34;&#34;</span> <span class="o">[</span>AmazonLinux2/1.22<span class="o">]</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  nodegroup <span class="s2">&#34;nodegroupB&#34;</span> will use <span class="s2">&#34;&#34;</span> <span class="o">[</span>AmazonLinux2/1.22<span class="o">]</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  nodegroup <span class="s2">&#34;nodegroupC&#34;</span> will use <span class="s2">&#34;&#34;</span> <span class="o">[</span>AmazonLinux2/1.22<span class="o">]</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  using Kubernetes version 1.22
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  creating EKS cluster <span class="s2">&#34;ca-cluster&#34;</span> in <span class="s2">&#34;us-east-1&#34;</span> region with managed nodes
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  <span class="m">3</span> nodegroups <span class="o">(</span>nodegroupA, nodegroupB, nodegroupC<span class="o">)</span> were included <span class="o">(</span>based on the include/exclude rules<span class="o">)</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  will create a CloudFormation stack <span class="k">for</span> cluster itself and <span class="m">0</span> nodegroup stack<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  will create a CloudFormation stack <span class="k">for</span> cluster itself and <span class="m">3</span> managed nodegroup stack<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  <span class="k">if</span> you encounter any issues, check CloudFormation console or try <span class="s1">&#39;eksctl utils describe-stacks --region=us-east-1 --cluster=ca-cluster&#39;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  Kubernetes API endpoint access will use default of <span class="o">{</span><span class="nv">publicAccess</span><span class="o">=</span>true, <span class="nv">privateAccess</span><span class="o">=</span>false<span class="o">}</span> <span class="k">for</span> cluster <span class="s2">&#34;ca-cluster&#34;</span> in <span class="s2">&#34;us-east-1&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  CloudWatch logging will not be enabled <span class="k">for</span> cluster <span class="s2">&#34;ca-cluster&#34;</span> in <span class="s2">&#34;us-east-1&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  you can <span class="nb">enable</span> it with <span class="s1">&#39;eksctl utils update-cluster-logging --enable-types={SPECIFY-YOUR-LOG-TYPES-HERE (e.g. all)} --region=us-east-1 --cluster=ca-cluster&#39;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  
</span></span><span class="line"><span class="cl"><span class="m">2</span> sequential tasks: <span class="o">{</span> create cluster control plane <span class="s2">&#34;ca-cluster&#34;</span>, 
</span></span><span class="line"><span class="cl">    <span class="m">2</span> sequential sub-tasks: <span class="o">{</span> 
</span></span><span class="line"><span class="cl">        <span class="nb">wait</span> <span class="k">for</span> control plane to become ready,
</span></span><span class="line"><span class="cl">        <span class="m">3</span> parallel sub-tasks: <span class="o">{</span> 
</span></span><span class="line"><span class="cl">            create managed nodegroup <span class="s2">&#34;nodegroupA&#34;</span>,
</span></span><span class="line"><span class="cl">            create managed nodegroup <span class="s2">&#34;nodegroupB&#34;</span>,
</span></span><span class="line"><span class="cl">            create managed nodegroup <span class="s2">&#34;nodegroupC&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="o">}</span>,
</span></span><span class="line"><span class="cl">    <span class="o">}</span> 
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  building cluster stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:06 <span class="o">[</span>â„¹<span class="o">]</span>  deploying stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:03:36 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:04:06 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:05:06 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:06:06 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:07:06 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:08:06 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:09:06 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:10:06 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:11:07 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:12:07 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:13:07 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:14:07 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:16:08 <span class="o">[</span>â„¹<span class="o">]</span>  building managed nodegroup stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:16:08 <span class="o">[</span>â„¹<span class="o">]</span>  building managed nodegroup stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:16:08 <span class="o">[</span>â„¹<span class="o">]</span>  building managed nodegroup stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:16:08 <span class="o">[</span>â„¹<span class="o">]</span>  deploying stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:16:08 <span class="o">[</span>â„¹<span class="o">]</span>  deploying stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:16:08 <span class="o">[</span>â„¹<span class="o">]</span>  deploying stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:16:08 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:16:08 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:16:08 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:16:38 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:16:38 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:16:38 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:17:19 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:17:19 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:17:25 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:18:07 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:18:40 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:18:47 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:19:08 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:26 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:34 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> the control plane availability...
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>âœ”<span class="o">]</span>  saved kubeconfig as <span class="s2">&#34;/home/cloudshell-user/.kube/config&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  no tasks
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>âœ”<span class="o">]</span>  all EKS cluster resources <span class="k">for</span> <span class="s2">&#34;ca-cluster&#34;</span> have been created
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  nodegroup <span class="s2">&#34;nodegroupA&#34;</span> has <span class="m">1</span> node<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  node <span class="s2">&#34;ip-192-168-11-66.ec2.internal&#34;</span> is ready
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> at least <span class="m">1</span> node<span class="o">(</span>s<span class="o">)</span> to become ready in <span class="s2">&#34;nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  nodegroup <span class="s2">&#34;nodegroupA&#34;</span> has <span class="m">1</span> node<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  node <span class="s2">&#34;ip-192-168-11-66.ec2.internal&#34;</span> is ready
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  nodegroup <span class="s2">&#34;nodegroupB&#34;</span> has <span class="m">1</span> node<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  node <span class="s2">&#34;ip-192-168-51-71.ec2.internal&#34;</span> is ready
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> at least <span class="m">1</span> node<span class="o">(</span>s<span class="o">)</span> to become ready in <span class="s2">&#34;nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  nodegroup <span class="s2">&#34;nodegroupB&#34;</span> has <span class="m">1</span> node<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  node <span class="s2">&#34;ip-192-168-51-71.ec2.internal&#34;</span> is ready
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  nodegroup <span class="s2">&#34;nodegroupC&#34;</span> has <span class="m">1</span> node<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  node <span class="s2">&#34;ip-192-168-73-100.ec2.internal&#34;</span> is ready
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> at least <span class="m">1</span> node<span class="o">(</span>s<span class="o">)</span> to become ready in <span class="s2">&#34;nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  nodegroup <span class="s2">&#34;nodegroupC&#34;</span> has <span class="m">1</span> node<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  node <span class="s2">&#34;ip-192-168-73-100.ec2.internal&#34;</span> is ready
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>âœ–<span class="o">]</span>  parsing kubectl version string  <span class="o">(</span>upstream error: error: <span class="nb">exec</span> plugin: invalid apiVersion <span class="s2">&#34;client.authentication.k8s.io/v1alpha1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span> / <span class="s2">&#34;0.0.0&#34;</span>: Version string empty
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>â„¹<span class="o">]</span>  cluster should be functional despite missing <span class="o">(</span>or misconfigured<span class="o">)</span> client binaries
</span></span><span class="line"><span class="cl">2022-05-12 08:20:35 <span class="o">[</span>âœ”<span class="o">]</span>  EKS cluster <span class="s2">&#34;ca-cluster&#34;</span> in <span class="s2">&#34;us-east-1&#34;</span> region is ready
</span></span></code></pre></div><p>Download the kubeconfig</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ aws eks update-kubeconfig --name ca-cluster --region<span class="o">=</span>us-east-1
</span></span><span class="line"><span class="cl">Added new context arn:aws:eks:us-east-1:566428305604:cluster/ca-cluster to /home/cloudshell-user/.kube/config
</span></span></code></pre></div><p>Check the cluster is running ok</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ kubectl get nodes
</span></span><span class="line"><span class="cl">NAME                             STATUS   ROLES    AGE   VERSION
</span></span><span class="line"><span class="cl">ip-192-168-11-66.ec2.internal    Ready    &lt;none&gt;   17m   v1.22.6-eks-7d68063
</span></span><span class="line"><span class="cl">ip-192-168-51-71.ec2.internal    Ready    &lt;none&gt;   17m   v1.22.6-eks-7d68063
</span></span><span class="line"><span class="cl">ip-192-168-73-100.ec2.internal   Ready    &lt;none&gt;   17m   v1.22.6-eks-7d68063
</span></span></code></pre></div><p>Update the Auto scalling groups to add extra nodes and a limit</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ aws autoscaling describe-auto-scaling-groups --query <span class="s2">&#34;AutoScalingGroups[? Tags[? (Key==&#39;eks:cluster-name&#39;) &amp;&amp; Value==&#39;</span><span class="nv">$CLUSTER_NAME</span><span class="s2">&#39;]].AutoScalingGroupName&#34;</span> --output text &gt; asg.txt
</span></span><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ <span class="k">for</span> x in <span class="k">$(</span>cat asg.txt<span class="k">)</span><span class="p">;</span> <span class="k">do</span> aws autoscaling update-auto-scaling-group --auto-scaling-group-name  <span class="nv">$x</span>  --min-size <span class="m">1</span> --desired-capacity <span class="m">1</span> --max-size 2<span class="p">;</span> <span class="k">done</span>
</span></span></code></pre></div><p>Create the IAM Policy and ServiceAccount for the cluster autoscaler</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ aws iam create-policy     --policy-name <span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span>-k8s-asg-policy   --policy-document file://k8s-asg-policy.json
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Policy&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;PolicyName&#34;</span>: <span class="s2">&#34;ca-cluster-k8s-asg-policy&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;PolicyId&#34;</span>: <span class="s2">&#34;ANPAYHYOCBDCEETZ2NA33&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Arn&#34;</span>: <span class="s2">&#34;arn:aws:iam::566428305604:policy/ca-cluster-k8s-asg-policy&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Path&#34;</span>: <span class="s2">&#34;/&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;DefaultVersionId&#34;</span>: <span class="s2">&#34;v1&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;AttachmentCount&#34;</span>: 0,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;PermissionsBoundaryUsageCount&#34;</span>: 0,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;IsAttachable&#34;</span>: true,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;CreateDate&#34;</span>: <span class="s2">&#34;2022-05-12T08:26:23+00:00&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;UpdateDate&#34;</span>: <span class="s2">&#34;2022-05-12T08:26:23+00:00&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ eksctl create iamserviceaccount   --name cluster-autoscaler   --namespace kube-system   --cluster <span class="nv">$CLUSTER_NAME</span>   --attach-policy-arn <span class="s2">&#34;arn:aws:iam::</span><span class="si">${</span><span class="nv">ACCOUNT_ID</span><span class="si">}</span><span class="s2">:policy/</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span><span class="s2">-k8s-asg-policy&#34;</span>   --approve   --override-existing-serviceaccounts
</span></span></code></pre></div><p>Deploy the CA</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ envsubst &lt; cluster-autoscaler-autodiscover.yaml <span class="p">|</span> kubectl apply -f -
</span></span><span class="line"><span class="cl">clusterrole.rbac.authorization.k8s.io/cluster-autoscaler created
</span></span><span class="line"><span class="cl">role.rbac.authorization.k8s.io/cluster-autoscaler created
</span></span><span class="line"><span class="cl">clusterrolebinding.rbac.authorization.k8s.io/cluster-autoscaler created
</span></span><span class="line"><span class="cl">rolebinding.rbac.authorization.k8s.io/cluster-autoscaler created
</span></span><span class="line"><span class="cl">deployment.apps/cluster-autoscaler created
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ kubectl -n kube-system annotate deployment.apps/cluster-autoscaler  cluster-autoscaler.kubernetes.io/safe-to-evict<span class="o">=</span><span class="s2">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">deployment.apps/cluster-autoscaler annotated
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ <span class="nb">export</span> <span class="nv">AUTOSCALER_VERSION</span><span class="o">=</span>1.22.2
</span></span><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ kubectl -n kube-system <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>&gt;     <span class="nb">set</span> image deployment.apps/cluster-autoscaler <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>&gt;     cluster-autoscaler<span class="o">=</span>us.gcr.io/k8s-artifacts-prod/autoscaling/cluster-autoscaler:v<span class="si">${</span><span class="nv">AUTOSCALER_VERSION</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">deployment.apps/cluster-autoscaler image updated
</span></span></code></pre></div><p>Delete the cluster</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ eksctl delete cluster ca-cluster
</span></span><span class="line"><span class="cl">2022-05-12 08:36:38 <span class="o">[</span>â„¹<span class="o">]</span>  eksctl version 0.96.0
</span></span><span class="line"><span class="cl">2022-05-12 08:36:38 <span class="o">[</span>â„¹<span class="o">]</span>  using region us-east-1
</span></span><span class="line"><span class="cl">2022-05-12 08:36:38 <span class="o">[</span>â„¹<span class="o">]</span>  deleting EKS cluster <span class="s2">&#34;ca-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:36:39 <span class="o">[</span>â„¹<span class="o">]</span>  will drain <span class="m">0</span> unmanaged nodegroup<span class="o">(</span>s<span class="o">)</span> in cluster <span class="s2">&#34;ca-cluster&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:36:39 <span class="o">[</span>â„¹<span class="o">]</span>  deleted <span class="m">0</span> Fargate profile<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:36:39 <span class="o">[</span>âœ”<span class="o">]</span>  kubeconfig has been updated
</span></span><span class="line"><span class="cl">2022-05-12 08:36:39 <span class="o">[</span>â„¹<span class="o">]</span>  cleaning up AWS load balancers created by Kubernetes objects of Kind Service or Ingress
</span></span><span class="line"><span class="cl">2022-05-12 08:36:48 <span class="o">[</span>â„¹<span class="o">]</span>  
</span></span><span class="line"><span class="cl"><span class="m">3</span> sequential tasks: <span class="o">{</span> 
</span></span><span class="line"><span class="cl">    <span class="m">3</span> parallel sub-tasks: <span class="o">{</span> 
</span></span><span class="line"><span class="cl">        delete nodegroup <span class="s2">&#34;nodegroupC&#34;</span>,
</span></span><span class="line"><span class="cl">        delete nodegroup <span class="s2">&#34;nodegroupA&#34;</span>,
</span></span><span class="line"><span class="cl">        delete nodegroup <span class="s2">&#34;nodegroupB&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, 
</span></span><span class="line"><span class="cl">    <span class="m">2</span> sequential sub-tasks: <span class="o">{</span> 
</span></span><span class="line"><span class="cl">        <span class="m">2</span> sequential sub-tasks: <span class="o">{</span> 
</span></span><span class="line"><span class="cl">            delete IAM role <span class="k">for</span> serviceaccount <span class="s2">&#34;kube-system/cluster-autoscaler&#34;</span>,
</span></span><span class="line"><span class="cl">            delete serviceaccount <span class="s2">&#34;kube-system/cluster-autoscaler&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="o">}</span>,
</span></span><span class="line"><span class="cl">        delete IAM OIDC provider,
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, delete cluster control plane <span class="s2">&#34;ca-cluster&#34;</span> <span class="o">[</span>async<span class="o">]</span> 
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:36:48 <span class="o">[</span>â„¹<span class="o">]</span>  will delete stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:36:48 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span> to get deleted
</span></span><span class="line"><span class="cl">2022-05-12 08:36:48 <span class="o">[</span>â„¹<span class="o">]</span>  will delete stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:36:48 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span> to get deleted
</span></span><span class="line"><span class="cl">2022-05-12 08:36:48 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:36:49 <span class="o">[</span>â„¹<span class="o">]</span>  will delete stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:36:49 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span> to get deleted
</span></span><span class="line"><span class="cl">2022-05-12 08:36:49 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:36:49 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:37:18 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:37:19 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:37:19 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:37:51 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:37:54 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:38:09 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:38:29 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:39:49 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:39:54 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:40:14 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:40:32 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:40:51 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:41:12 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:41:35 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:42:13 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:42:46 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:42:57 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:43:05 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:43:35 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:44:23 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:44:47 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupC&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:45:04 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupB&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:46:00 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-nodegroup-nodegroupA&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:46:02 <span class="o">[</span>â„¹<span class="o">]</span>  will delete stack <span class="s2">&#34;eksctl-ca-cluster-addon-iamserviceaccount-kube-system-cluster-autoscaler&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:46:02 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> stack <span class="s2">&#34;eksctl-ca-cluster-addon-iamserviceaccount-kube-system-cluster-autoscaler&#34;</span> to get deleted
</span></span><span class="line"><span class="cl">2022-05-12 08:46:04 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-addon-iamserviceaccount-kube-system-cluster-autoscaler&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:46:34 <span class="o">[</span>â„¹<span class="o">]</span>  waiting <span class="k">for</span> CloudFormation stack <span class="s2">&#34;eksctl-ca-cluster-addon-iamserviceaccount-kube-system-cluster-autoscaler&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:46:34 <span class="o">[</span>â„¹<span class="o">]</span>  deleted serviceaccount <span class="s2">&#34;kube-system/cluster-autoscaler&#34;</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:46:34 <span class="o">[</span>â„¹<span class="o">]</span>  <span class="m">1</span> error<span class="o">(</span>s<span class="o">)</span> occurred <span class="k">while</span> deleting cluster with nodegroup<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">2022-05-12 08:46:34 <span class="o">[</span>âœ–<span class="o">]</span>  deleting OIDC provider: operation error IAM: DeleteOpenIDConnectProvider, https response error StatusCode: 403, RequestID: 3944137c-c5ff-4263-8156-db113d89d620, api error AccessDenied: User: arn:aws:iam::566428305604:user/cloud_user is not authorized to perform: iam:DeleteOpenIDConnectProvider on resource: arn:aws:iam::566428305604:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/7B0C3F25F3AC9E9E3C2EEDB41AC61FB9 with an explicit deny in a service control policy
</span></span><span class="line"><span class="cl">Error: failed to delete cluster with nodegroup<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>cloudshell-user@ip-10-1-181-252 cluster-autoscaler<span class="o">]</span>$ 
</span></span></code></pre></div>

        
          <div class="blog-tags">
            
              <a href="https://neilarmitage.com//tags/aws/">AWS</a>&nbsp;
            
              <a href="https://neilarmitage.com//tags/eks/">EKS</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://neilarmitage.com/posts/cilium-chaining/" data-toggle="tooltip" data-placement="top" title="EKS with Cilium in chaining mode">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://neilarmitage.com/posts/karpenter/" data-toggle="tooltip" data-placement="top" title="Installing Karpenter">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="mailto:neil@neilarmitage.com" title="Email me">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://github.com/narmitag" title="GitHub">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://twitter.com/narmitage" title="Twitter">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://linkedin.com/in/neil-a-5750885" title="LinkedIn">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="neilarmitage.com">Neil Armitage</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2022
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://neilarmitage.com/">Random Stuff From My Head</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.107.0</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          &nbsp;&bull;&nbsp;[<a href="https://github.com/narmitag/narmitag.github.io/d60d4ac1fd0e7602b7f1e28b6da5d971c1964ab7">d60d4ac1</a>]
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://neilarmitage.com/js/main.js"></script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://neilarmitage.com/js/load-photoswipe.js"></script>









    
  </body>
</html>

